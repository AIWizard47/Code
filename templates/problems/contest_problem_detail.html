<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contest Problem</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for modern typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* -------------------------------------------------------------------------- */
        /* Global & Base Styles - Matching problem_list.html                         */
        /* -------------------------------------------------------------------------- */

        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            line-height: 1.5;
        }

        /* Custom scrollbar styling for consistent dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #282828;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
            border: 1px solid #3a3a3a;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        /* -------------------------------------------------------------------------- */
        /* Main Container Layout                                                      */
        /* -------------------------------------------------------------------------- */

        .contest-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            background-color: #121212;
            overflow: hidden;
        }

        /* -------------------------------------------------------------------------- */
        /* Top Header Bar - Matching problem_list.html style                         */
        /* -------------------------------------------------------------------------- */

        .contest-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: #1e1e1e;
            border-bottom: 1px solid #3a3a3a;
            padding: 1rem 2rem;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .contest-title {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, #d1b5ffff 0%, #bfcafbff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .contest-timer {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .timer-display {
            font-weight: 700;
            font-size: 1.2rem;
            color: #fc8181;
            background-color: #2d3748;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid #4a5568;
        }

        .contest-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .contest-actions a, .contest-actions button {
            color: #b0b0b0;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid #555;
            background: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .contest-actions a:hover, .contest-actions button:hover {
            background-color: #333;
            border-color: #667eea;
            color: #fff;
        }

        /* -------------------------------------------------------------------------- */
        /* Left Panel - Problem Description                                           */
        /* -------------------------------------------------------------------------- */

        .problem-panel {
            flex: 1;
            flex-basis: 45%;
            background-color: #1e1e1e;
            border-right: 1px solid #3a3a3a;
            padding: 2rem;
            padding-top: 90px; /* Account for fixed header */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .problem-header {
            margin-bottom: 2rem;
        }

        .problem-title {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(90deg, #d1b5ffff 0%, #bfcafbff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .difficulty-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid;
            margin-bottom: 1.5rem;
        }

        .difficulty-medium {
            background-color: #a06e1e;
            color: #fbd38d;
            border-color: #ecc94b;
        }
        .difficulty-easy {
            background-color: #28a745; /* green */
        }

        .difficulty-hard {
            background-color: #dc3545; /* red */
        }

        .problem-content h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #bfcafbff;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .problem-content p {
            color: #c0c0c0;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .sample-container {
            background-color: #2d3748;
            border-radius: 8px;
            border: 1px solid #4a5568;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .sample-container h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 0.75rem;
        }

        .sample-container pre {
            background-color: #1a202c;
            border: 1px solid #4a5568;
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #e2e8f0;
            overflow-x: auto;
        }

        /* -------------------------------------------------------------------------- */
        /* Resize Handle                                                              */
        /* -------------------------------------------------------------------------- */

        .resize-handle {
            width: 8px;
            cursor: ew-resize;
            background-color: #3a3a3a;
            flex-shrink: 0;
            transition: background-color 0.2s ease;
        }

        .resize-handle:hover {
            background-color: #667eea;
        }

        /* -------------------------------------------------------------------------- */
        /* Right Panel - Code Editor                                                  */
        /* -------------------------------------------------------------------------- */

        .editor-panel {
            flex: 1;
            flex-basis: 55%;
            background-color: #121212;
            display: flex;
            flex-direction: column;
            padding-top: 70px; /* Account for fixed header */
        }

        .editor-header {
            background-color: #1e1e1e;
            border-bottom: 1px solid #3a3a3a;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .editor-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e0e0e0;
        }

        .editor-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .language-select {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .language-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .editor-container {
            flex-grow: 1;
            margin: 1rem;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
            overflow: hidden;
        }

        /* -------------------------------------------------------------------------- */
        /* Bottom Panel - Console & Results                                           */
        /* -------------------------------------------------------------------------- */

        .bottom-panel {
            background-color: #1e1e1e;
            border-top: 1px solid #3a3a3a;
            flex-shrink: 0;
            height: 250px;
            display: flex;
            flex-direction: column;
        }

        .bottom-header {
            padding: 1rem 2rem;
            border-bottom: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .tab-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .tab-button {
            padding: 0.5rem 1rem;
            background: none;
            border: 1px solid #555;
            color: #b0b0b0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .tab-button.active {
            background-color: #667eea;
            border-color: #667eea;
            color: #fff;
        }

        .submit-button {
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.3);
        }

        .submit-button:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .bottom-content {
            flex-grow: 1;
            padding: 1.5rem 2rem;
            overflow-y: auto;
        }

        .input-area {
            margin-bottom: 1.5rem;
        }

        .input-area label {
            display: block;
            font-weight: 600;
            color: #b0b0b0;
            margin-bottom: 0.5rem;
        }

        .input-area textarea {
            width: 100%;
            background-color: #2d3748;
            border: 1px solid #4a5568;
            color: #e2e8f0;
            padding: 0.75rem;
            border-radius: 6px;
            font-family: monospace;
            resize: vertical;
        }

        .input-area textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .test-button {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .results-area {
            display: none;
        }

        .results-area.active {
            display: block;
        }

        .result-box {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .result-box h4 {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .result-box pre {
            font-family: monospace;
            font-size: 0.9rem;
            color: #e2e8f0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .result-success {
            border-color: #48bb78;
        }

        .result-success h4 {
            color: #68d391;
        }

        .result-error {
            border-color: #f56565;
        }

        .result-error h4 {
            color: #fc8181;
        }

        /* -------------------------------------------------------------------------- */
        /* Responsive Design                                                          */
        /* -------------------------------------------------------------------------- */

        @media (max-width: 1024px) {
            .contest-container {
                flex-direction: column;
            }

            .problem-panel {
                flex-basis: 40%;
                padding: 1rem;
                padding-top: 90px;
            }

            .editor-panel {
                flex-basis: 60%;
            }

            .resize-handle {
                display: none;
            }

            .contest-header {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .contest-timer {
                order: 3;
                flex-basis: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .problem-panel {
                padding: 1rem;
                padding-top: 110px;
            }

            .editor-container {
                margin: 0.5rem;
            }

            .problem-title {
                font-size: 1.5rem;
            }

            .contest-header {
                padding: 1rem;
                height: auto;
                min-height: 70px;
            }

            .bottom-panel {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Contest Header -->
    <header class="contest-header">
        <div class="contest-title">CodeChallenge Contest</div>
        <div class="contest-timer">
                <span style="color: #888;">Time Remaining:</span>
                <div id="timer" id="countdown" class="timer-display">Calculating...</div>
                    <script>
                        // Contest timer functionality
                        const endTime = new Date("{{ contest.end_time|date:'c' }}").getTime();
                        const timerElement = document.getElementById("timer");

                        function updateTimer() {
                            const now = new Date().getTime();
                            const diff = endTime - now;
                            const hours = Math.floor(diff / (1000 * 60 * 60));
                            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                            
                            timerElement.textContent = `${String(hours).padStart(2, '0')}h ${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
                        }

                        const timerInterval = setInterval(updateTimer, 1000);
                        updateTimer(); // Initial call
                    </script>
            {% comment %} <span style="color: #888;">Time Remaining:</span> {% endcomment %}
            {% comment %} <div id="countdown" class="timer-display">02:45:23</div> {% endcomment %}
        </div>
        <div class="contest-actions">
            <span style="color: #b0b0b0;">Welcome, {{user}}</span>
            <button onclick="exitContest()">Exit Contest</button>
        </div>
    </header>

    <!-- Main Contest Container -->
    <div class="contest-container">
        <!-- Left Panel: Problem Description -->
        <div id="problemPanel" class="problem-panel">
            <div class="problem-content">
                <div class="problem-header">
                    <h1 class="problem-title">{{problem}}</h1>
                    <span class="difficulty-badge difficulty-{{problem.difficulty|lower}}">{{problem.difficulty}}</span>
                </div>
                <p class="text-lg text-gray-300 mb-4 leading-relaxed">{{ problem.description|linebreaks }}</p>
                <div class="mb-4">
                    <h3 class="text-xl font-bold text-gray-400 mb-2">Input:</h3>
                    <p class="text-gray-300 leading-relaxed">{{ problem.input_description }}</p>
                </div>
                <div class="mb-4">
                    <h3 class="text-xl font-bold text-gray-400 mb-2">Output:</h3>
                    <p class="text-gray-300 leading-relaxed">{{ problem.output_description }}</p>
                </div>
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-gray-400 mb-2">Constraints:</h3>
                    <p class="text-gray-300 leading-relaxed">{{ problem.constraints }}</p>
                </div>

                <div class="bg-gray-700 p-6 rounded-lg border border-gray-600 mb-4 shadow-sm">
                    <h3 class="text-xl font-bold text-gray-400 mb-3">Sample Input</h3>
                    <pre class="bg-gray-800 p-4 rounded-md border border-gray-600 text-sm font-mono text-gray-100 overflow-auto">{{ problem.sample_input }}</pre>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg border border-gray-600 mb-4 shadow-sm">
                    <h3 class="text-xl font-bold text-gray-400 mb-3">Sample Output</h3>
                    <pre class="bg-gray-800 p-4 rounded-md border border-gray-600 text-sm font-mono text-gray-100 overflow-auto">{{ problem.sample_output }}</pre>
                </div>
            </div>
        </div>

        <!-- Resize Handle -->
        <div id="resizeHandle" class="resize-handle"></div>

        <!-- Right Panel: Code Editor -->
        <div id="editorPanel" class="editor-panel">
            <!-- Editor Header -->
            <div class="editor-header">
                <div class="editor-title">Solution</div>
                <div class="editor-controls">


                    <form id="language-form" class="inline-block">
                        <select id="language" name="language" onchange="changeEditorLanguage(this.value)"
                                class="language-select">
                            <option value="python" {% if selected_language == "python" %}selected{% endif %}>Python3</option>
                            <option value="cpp" {% if selected_language == "cpp" %}selected{% endif %}>C++</option>
                            <option value="java" {% if selected_language == "java" %}selected{% endif %}>Java</option>
                        </select>
                    </form>

                    <!-- <label for="languageSelect" class="text-gray-300 mr-2">Language:</label> -->

                    <select id="languageSelect" class="language-select">
                        <option value="python">Python3</option>
                        <option value="cpp">C++</option>
                        <option value="java">Java</option>
                    </select>
                </div>
            </div>

            <!-- Monaco Editor Container -->
            <div id="editor" class="editor-container"></div>

            <!-- Bottom Panel: Console & Results -->
            <div class="bottom-panel">
                <div class="bottom-header">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchTab('input')">Custom Input</button>
                        <button class="tab-button" onclick="switchTab('results')">Results</button>
                    </div>
                    <button id="submitBtn" class="submit-button">
                        <span>Submit Solution</span>
                    </button>
                </div>

                <div class="bottom-content">
                    <!-- Custom Input Tab -->
                    <div id="inputTab" class="input-area">
                        <label for="customInput">Test with custom input:</label>
                        <textarea id="customInput" rows="4" placeholder="Enter your test input here...">nums = [2,7,11,15]
target = 9</textarea>
                        <button class="test-button" onclick="runTest()" style="margin-top: 0.5rem;">Run Test</button>
                    </div>

                    <!-- Results Tab -->
                    <div id="resultsTab" class="results-area">
                        <div class="result-box">
                            <h4>Status</h4>
                            <pre id="statusResult">Ready to submit...</pre>
                        </div>
                        <div class="result-box">
                            <h4>Output</h4>
                            <pre id="outputResult">No output yet.</pre>
                        </div>
                        <div class="result-box">
                            <h4>Error Output</h4>
                            <pre id="errorResult">No errors.</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monaco Editor -->
    <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
    <script>
        let editor;
        let isResizing = false;
        let startTime = new Date().getTime() + (3 * 60 * 60 * 1000); // 3 hours from now

        // Initialize Monaco Editor
        require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@latest/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: `def twoSum(nums, target):
    """
    Find two numbers in the array that add up to target.
    Return their indices.
    """
    # Write your solution here
    for i in range(len(nums)):
        for j in range(i + 1, len(nums)):
            if nums[i] + nums[j] == target:
                return [i, j]
    return []

# Test the function
nums = [2, 7, 11, 15]
target = 9
result = twoSum(nums, target)
print(result)`,
                language: 'python',
                theme: 'vs-dark',
                automaticLayout: true,
                fontSize: 14,
                lineNumbers: 'on',
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                wordWrap: 'on'
            });
        });

        // Contest Timer
        function updateTimer() {
            const now = new Date().getTime();
            const timeLeft = startTime - now;
            
            if (timeLeft <= 0) {
                document.getElementById('countdown').textContent = 'Contest Ended';
                document.getElementById('countdown').style.color = '#fc8181';
                if (editor) {
                    editor.updateOptions({ readOnly: true });
                }
                document.getElementById('submitBtn').disabled = true;
                return;
            }
            
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            document.getElementById('countdown').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        setInterval(updateTimer, 1000);
        updateTimer();

        // Panel Resizing
        const problemPanel = document.getElementById('problemPanel');
        const editorPanel = document.getElementById('editorPanel');
        const resizeHandle = document.getElementById('resizeHandle');

        resizeHandle.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.body.style.cursor = 'ew-resize';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            
            const containerWidth = document.querySelector('.contest-container').offsetWidth;
            const newLeftWidth = (e.clientX / containerWidth) * 100;
            
            if (newLeftWidth > 20 && newLeftWidth < 80) {
                problemPanel.style.flexBasis = `${newLeftWidth}%`;
                editorPanel.style.flexBasis = `${100 - newLeftWidth}%`;
            }
        });

        document.addEventListener('mouseup', () => {
            isResizing = false;
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
        });

        // Tab Switching
        function switchTab(tab) {
            const buttons = document.querySelectorAll('.tab-button');
            const inputTab = document.getElementById('inputTab');
            const resultsTab = document.getElementById('resultsTab');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (tab === 'input') {
                event.target.classList.add('active');
                inputTab.style.display = 'block';
                resultsTab.classList.remove('active');
            } else {
                event.target.classList.add('active');
                inputTab.style.display = 'none';
                resultsTab.classList.add('active');
            }
        }

        // Language Change
        document.getElementById('languageSelect').addEventListener('change', function() {
            const language = this.value;
            const templates = {
                python: `def twoSum(nums, target):
    """
    Find two numbers in the array that add up to target.
    Return their indices.
    """
    # Write your solution here
    pass`,
                cpp: `#include <vector>
#include <iostream>
using namespace std;

class Solution {
public:
    vector<int> twoSum(vector<int>& nums, int target) {
        // Write your solution here
        return {};
    }
};`,
                java: `import java.util.*;

public class Solution {
    public int[] twoSum(int[] nums, int target) {
        // Write your solution here
        return new int[]{};
    }
}`
            };
            
            if (editor && templates[language]) {
                editor.setValue(templates[language]);
                monaco.editor.setModelLanguage(editor.getModel(), language === 'cpp' ? 'cpp' : language);
            }
        });

        // Test Function
        function runTest() {
            switchTab('results');
            document.querySelector('.tab-button:nth-child(2)').classList.add('active');
            document.querySelector('.tab-button:nth-child(1)').classList.remove('active');
            
            document.getElementById('statusResult').textContent = 'Running test...';
            document.getElementById('outputResult').textContent = 'Processing...';
            document.getElementById('errorResult').textContent = 'No errors.';
            
            // Simulate test execution
            setTimeout(() => {
                document.getElementById('statusResult').textContent = 'Test completed successfully';
                document.getElementById('outputResult').textContent = '[0, 1]';
                document.querySelector('.result-box').classList.add('result-success');
            }, 1000);
        }

        // Submit Function
        document.getElementById('submitBtn').addEventListener('click', function() {
            const code = editor.getValue();
            if (!code.trim()) {
                alert('Please write some code before submitting.');
                return;
            }
            
            this.disabled = true;
            this.innerHTML = '<span>Submitting...</span>';
            
            // Switch to results tab
            switchTab('results');
            document.querySelector('.tab-button:nth-child(2)').classList.add('active');
            document.querySelector('.tab-button:nth-child(1)').classList.remove('active');
            
            document.getElementById('statusResult').textContent = 'Submitting solution...';
            
            // Simulate submission
            setTimeout(() => {
                document.getElementById('statusResult').textContent = 'Accepted - All test cases passed!';
                document.getElementById('outputResult').textContent = 'Runtime: 52 ms\nMemory: 15.1 MB\nScore: 100/100';
                document.querySelector('.result-box').classList.add('result-success');
                
                this.disabled = false;
                this.innerHTML = '<span>Submit Solution</span>';
            }, 2000);
        });

        // Exit Contest
        function exitContest() {
            if (confirm('Are you sure you want to exit the contest? Your progress will be saved.')) {
                window.location.href = '#';
            }
        }

        // Prevent cheating attempts
        document.addEventListener('keydown', function(e) {
            // Disable F12, Ctrl+Shift+I, etc.
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) {
                e.preventDefault();
                alert('Developer tools are disabled during the contest.');
            }
        });

        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            alert('Right-click is disabled during the contest.');
        });
    </script>
</body>
</html>