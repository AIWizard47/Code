<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeChallenge - Leaderboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        /* Custom gradient background */
        .bg-gradient-dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
        }

        /* Glow effects */
        .glow-purple {
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.3);
        }

        .text-glow {
            text-shadow: 0 0 10px rgba(147, 51, 234, 0.5);
        }
    </style>
</head>
<body class="bg-gradient-dark min-h-screen font-sans text-gray-100">

    <!-- Sidebar Navigation -->
    <div class="flex">
        <div class="w-64 bg-gray-900 min-h-screen p-6 fixed left-0 top-0">
            <!-- Logo -->
            <div class="mb-8">
                <h1 class="text-2xl font-bold text-purple-400 text-glow">Code</h1>
                <p class="text-gray-400 text-sm">Problem Hub</p>
            </div>
            <!-- Navigation Menu -->
            <nav class="space-y-2">
                <a href="/" class="flex items-center space-x-3 text-gray-300 hover:text-white hover:bg-gray-800 px-3 py-2 rounded-lg transition duration-200">
                    <span class="text-red-400">üìã</span>
                    <span>Problems</span>
                </a>
                <a href="/contests/" class="flex items-center space-x-3 text-gray-300 hover:text-white hover:bg-gray-800 px-3 py-2 rounded-lg transition duration-200">
                    <span class="text-yellow-400">üèÜ</span>
                    <span>Contests</span>
                </a>
                <a href="/submissions/history/" class="flex items-center space-x-3 text-gray-300 hover:text-white hover:bg-gray-800 px-3 py-2 rounded-lg transition duration-200">
                    <span class="text-blue-400">üìÑ</span>
                    <span>My Submissions</span>
                </a>
                <a href="/submissions/leaderboard/" class="flex items-center space-x-3 text-white bg-gray-800 px-3 py-2 rounded-lg border-l-4 border-purple-500">
                    <span class="text-orange-400">üëë</span>
                    <span>Leaderboard</span>
                </a>
                {% comment %} <a href="#" class="flex items-center space-x-3 text-gray-300 hover:text-white hover:bg-gray-800 px-3 py-2 rounded-lg transition duration-200">
                    <span class="text-green-400">üí™</span>
                    <span>Practice</span>
                </a>
                <a href="#" class="flex items-center space-x-3 text-gray-300 hover:text-white hover:bg-gray-800 px-3 py-2 rounded-lg transition duration-200">
                    <span class="text-emerald-400">üìö</span>
                    <span>Tutorials</span>
                </a> {% endcomment %}
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 ml-64">
            <!-- Top Header -->
            <header class="bg-gray-800 border-b border-gray-700 px-6 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-2 text-gray-400">
                    <span>Dashboard</span>
                    <span>/</span>
                    <span class="text-blue-400">Leaderboard</span>
                </div>
                <div class="flex items-center space-x-4">
                    {% if user.is_authenticated %}
                    <span class="text-gray-300">Welcome, <span class="text-purple-400 font-semibold">user</span></span>
                        <a href="/logout/" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-sm transition duration-200">Logout</a>
                    {% else %}
                        <a href="/accounts/login/" class="text-indigo-400 hover:text-indigo-200 font-semibold transition duration-200">Login</a>
                        <a href="/account/registrations/" class="text-indigo-400 hover:text-indigo-200 font-semibold transition duration-200">SignUp</a>
                    {% endif %}
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="p-6">
                <!-- Page Title -->
                <div class="mb-8">
                    <h1 class="text-4xl font-bold text-purple-400 text-glow mb-2">Leaderboard</h1>
                    <p class="text-gray-400">See how you rank against other coders</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="text-3xl font-bold text-blue-400">{{user_count}}</div>
                        <div class="text-gray-400 text-sm">Total Users</div>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="text-3xl font-bold text-green-400">{{user_rank}}</div>
                        <div class="text-gray-400 text-sm">Your Rank</div>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
                        <div class="text-3xl font-bold text-purple-400">{{top_percent}}%</div>
                        <div class="text-gray-400 text-sm">Top Percentile</div>
                    </div>
                </div>

                <!-- Leaderboard Container -->
                <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden"
                     id="leaderboard-container"
                     hx-get="{% url 'leaderboard' %}"
                     hx-trigger="load"
                     hx-target="#leaderboard-container"
                     hx-swap="innerHTML">
                    
                    <!-- Leaderboard Header -->
                    <div class="px-6 py-4 border-b border-gray-700">
                        <h2 class="text-xl font-semibold text-white">Top Performers</h2>
                    </div>

                    <!-- Leaderboard Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-900">
                                <tr>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                                        Rank
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                                        User
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                                        Problems Solved
                                    </th>
                                    <th scope="col" class="px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                                        Status
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-gray-800 divide-y divide-gray-700">
                                {% for user in users %}
                                <tr class="hover:bg-gray-700 transition duration-150 ease-in-out">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            {% if forloop.counter0|add:users.start_index <= 3 %}
                                                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full 
                                                    {% if forloop.counter0|add:users.start_index == 1 %}bg-yellow-500 text-yellow-900
                                                    {% elif forloop.counter0|add:users.start_index == 2 %}bg-gray-400 text-gray-900
                                                    {% else %}bg-orange-600 text-orange-900{% endif %} 
                                                    font-bold text-sm">
                                                    {{ forloop.counter0|add:users.start_index }}
                                                </span>
                                            {% else %}
                                                <span class="text-gray-300 font-medium">{{ forloop.counter0|add:users.start_index }}</span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-white font-medium">{{ user.username }}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-900 text-purple-200 border border-purple-700">
                                            {{ user.solved_count }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {% if user.solved_count > 40 %}
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-900 text-green-200 border border-green-700">
                                                Active
                                            </span>
                                        {% else %}
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-700 text-gray-300 border border-gray-600">
                                                Normal
                                            </span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="px-6 py-8 text-center text-gray-500">
                                        <div class="flex flex-col items-center">
                                            <div class="text-4xl mb-2">üèÜ</div>
                                            <div>No users found</div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination Controls -->
                    <div class="px-6 py-4 bg-gray-900 border-t border-gray-700 flex items-center justify-between">
                        <div class="flex-1 flex justify-between sm:hidden">
                            {% if users.has_previous %}
                                <a href="?page={{ users.previous_page_number }}" class="relative inline-flex items-center px-4 py-2 border border-gray-600 text-sm font-medium rounded-md text-gray-300 bg-gray-800 hover:bg-gray-700">
                                    Previous
                                </a>
                            {% endif %}
                            {% if users.has_next %}
                                <a href="?page={{ users.next_page_number }}" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-600 text-sm font-medium rounded-md text-gray-300 bg-gray-800 hover:bg-gray-700">
                                    Next
                                </a>
                            {% endif %}
                        </div>
                        
                        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                            <div>
                                <p class="text-sm text-gray-400">
                                    Page <span class="font-medium text-white">{{ users.number }}</span> of <span class="font-medium text-white">{{ users.paginator.num_pages }}</span>
                                </p>
                            </div>
                            <div>
                                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                    {% if users.has_previous %}
                                        <a href="?page={{ users.previous_page_number }}" class="relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-600 bg-gray-800 text-sm font-medium text-gray-300 hover:bg-gray-700">
                                            Previous
                                        </a>
                                    {% endif %}
                                    {% if users.has_next %}
                                        <a href="?page={{ users.next_page_number }}" class="relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-600 bg-gray-800 text-sm font-medium text-gray-300 hover:bg-gray-700">
                                            Next
                                        </a>
                                    {% endif %}
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Demo Data Script for Testing -->
                <script>
                    // Example users data for local testing
                    const demoUsers = [
                        { username: "algo_master", solved_count: 85, rank: 1 },
                        { username: "code_ninja", solved_count: 73, rank: 2 },
                        { username: "dev_wizard", solved_count: 68, rank: 3 },
                        { username: "python_pro", solved_count: 52, rank: 4 },
                        { username: "js_guru", solved_count: 45, rank: 5 },
                        { username: "data_scientist", solved_count: 42, rank: 6 },
                        { username: "backend_beast", solved_count: 38, rank: 7 },
                        { username: "frontend_fox", solved_count: 33, rank: 8 },
                        { username: "fullstack_hero", solved_count: 29, rank: 9 },
                        { username: "ml_enthusiast", solved_count: 25, rank: 10 }
                    ];

                    // Function to render demo data (for local testing)
                    function renderDemoData() {
                        const tbody = document.querySelector('tbody');
                        if (tbody && window.location.search.includes('demo=true')) {
                            tbody.innerHTML = demoUsers.map((user, index) => `
                                <tr class="hover:bg-gray-700 transition duration-150 ease-in-out">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            ${user.rank <= 3 ? `
                                                <span class="inline-flex items-center justify-center w-8 h-8 rounded-full 
                                                    ${user.rank === 1 ? 'bg-yellow-500 text-yellow-900' : 
                                                      user.rank === 2 ? 'bg-gray-400 text-gray-900' : 'bg-orange-600 text-orange-900'} 
                                                    font-bold text-sm">
                                                    ${user.rank}
                                                </span>
                                            ` : `
                                                <span class="text-gray-300 font-medium">${user.rank}</span>
                                            `}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-white font-medium">${user.username}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-900 text-purple-200 border border-purple-700">
                                            ${user.solved_count}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        ${user.solved_count > 40 ? `
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-900 text-green-200 border border-green-700">
                                                Active
                                            </span>
                                        ` : `
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-700 text-gray-300 border border-gray-600">
                                                Normal
                                            </span>
                                        `}
                                    </td>
                                </tr>
                            `).join('');
                        }
                    }

                    document.addEventListener('DOMContentLoaded', renderDemoData);
                </script>
            </main>
        </div>
    </div>

</body>
</html>